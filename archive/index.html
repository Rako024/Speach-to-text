<!DOCTYPE html>
<html lang="az">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TV Arxiv & Klip Axtar</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #ecf0f1;
            --card-bg: #ffffff;
            --radius: 0.5rem;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--primary);
            padding: 1rem;
        }

        h1,
        h2 {
            text-align: center;
            margin-bottom: 1rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .controls input,
        .controls select,
        .controls button {
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border: 1px solid #bdc3c7;
            border-radius: var(--radius);
        }

        .controls button {
            background: var(--accent);
            color: #fff;
            border: none;
            cursor: pointer;
        }

        .controls button:hover {
            background: #2980b9;
        }

        #summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            white-space: pre-wrap;
            margin-bottom: 2rem;
        }

        #results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card p {
            margin-bottom: 0.5rem;
            flex-grow: 1;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-footer button {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
            border: none;
            border-radius: var(--radius);
            background: var(--primary);
            color: #fff;
            cursor: pointer;
        }

        .card-footer button:hover {
            opacity: 0.9;
        }

        video {
            display: block;
            margin: 0 auto;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 100%;
        }
    </style>
</head>

<body>
    <h1>TV Arxiv &amp; Klip Axtar</h1>

    <div class="controls">
        <input id="kw" placeholder="Keyword (məs: pasha bank)" />
        <select id="channel">
            <option value="">— Bütün kanallar —</option>
            <option value="aztv">AZTV</option>
            <option value="atv">ATV</option>
            <option value="itv">ITV</option>
        </select>
        <button id="btn">Axtar</button>
    </div>

    <h2>DeepSeek Qısa Xülasə:</h2>
    <div id="summary"></div>

    <h2>Tapılan seqmentlər:</h2>
    <div id="results"></div>

    <h2>Seçilmiş klip (±15s):</h2>
    <video id="player" controls></video>

    <script>
        const btn = document.getElementById("btn");
        const kwIn = document.getElementById("kw");
        const chIn = document.getElementById("channel");
        const sumEl = document.getElementById("summary");
        const resEl = document.getElementById("results");
        const player = document.getElementById("player");

        btn.addEventListener("click", async () => {
            const kw = kwIn.value.trim();
            const channel = chIn.value;
            if (!kw) return alert("Keyword daxil edin");

            let url = `/search/?keyword=${encodeURIComponent(kw)}`;
            if (channel) url += `&channel=${encodeURIComponent(channel)}`;

            const r = await fetch(url);
            if (!r.ok) return alert("Xəta: " + r.statusText);
            const { summary, segments } = await r.json();

            sumEl.textContent = summary;
            resEl.innerHTML = "";

            segments.forEach(seg => {
                const time = new Date(seg.start_time).toLocaleTimeString();
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
          <p><strong>[${time}]</strong> ${seg.text}</p>
          <div class="card-footer">
            <small>${seg.channel_id.toUpperCase()}</small>
            <button>Play</button>
          </div>
        `;

                const playBtn = card.querySelector("button");
                playBtn.addEventListener("click", () => {
                    let start = parseFloat(seg.offset_secs) - 15;
                    if (start < 0) start = 0;
                    const dur = parseFloat(seg.duration_secs) + 30;

                    player.src = `/video_clip/?channel=${encodeURIComponent(seg.channel_id)}` +
                        `&video_file=${encodeURIComponent(seg.segment_filename)}` +
                        `&start=${start}&duration=${dur}`;
                    player.load();
                    player.play();
                });

                resEl.appendChild(card);
            });
        });
    </script>
</body>

</html>